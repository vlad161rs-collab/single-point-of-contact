{% extends 'knowledgebase/base.html' %}
{% load static %}

{% block title %}–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π{% endblock %}

{% block content %}
<div class="knowledgebase-container">
  
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
  <div class="knowledgebase-header">
    <h1>üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h1>
    
    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
    <div class="instructions-box">
      <h3>üìñ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</h3>
      <div class="instructions-box-grid">
        <div>
          <strong>üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å—è–º–∏:</strong>
          <ul>
            {% if user.is_authenticated and perms.knowledgebase.add_article %}
              <li>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞—Ç—å–∏</li>
            {% endif %}
            <li>–ü–æ–∏—Å–∫ —Å—Ç–∞—Ç–µ–π</li>
            <li>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É –∏–ª–∏ –¥–∞—Ç–µ</li>
            <li>–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ</li>
            {% if user.is_authenticated and perms.knowledgebase.change_article %}
              <li>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–µ–π</li>
            {% endif %}
            {% if user.is_authenticated and perms.knowledgebase.delete_article %}
              <li>–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–µ–π</li>
            {% endif %}
          </ul>
        </div>
        <div>
          <strong>‚öôÔ∏è –û–±—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:</strong>
          <ul>
            <li>–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É</li>
            <li>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</li>
            <li>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å—Ç–∞—Ç—å—è–º</li>
            <li>–ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
  <div class="search-section">
    <form method="get" action="{% url 'knowledgebase:index' %}" class="search-form">
      <div class="search-form-group">
        <label>üîç –ü–æ–∏—Å–∫</label>
        <input type="text" 
               name="query"
               placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É..."
               value="{{ request.GET.query }}"
               class="form-control">
      </div>
      <div class="search-form-group">
        <label>üìä –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
        <select name="sort_by" class="form-control">
          <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
          <option value="title" {% if request.GET.sort_by == 'title' %}selected{% endif %}>–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</option>
          <option value="pub_date" {% if request.GET.sort_by == 'pub_date' %}selected{% endif %}>–ü–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è</option>
        </select>
      </div>
      <div>
        <button type="submit" class="search-form-button">üîç –ù–∞–π—Ç–∏</button>
      </div>
    </form>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç—å–∏ -->
  {% if user.is_authenticated and perms.knowledgebase.add_article %}
    <a href="{% url 'knowledgebase:article_create' %}" class="create-article-btn">
      ‚ûï –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é
    </a>
  {% endif %}

  <!-- –°–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–µ–π -->
  <div class="articles-list">
    <h2>üìÑ –°—Ç–∞—Ç—å–∏ ({{ articles|length }})</h2>
    
    {% if articles %}
      <div class="articles-grid">
        {% for article in articles %}
          <div class="article-card" onclick="window.location.href='{% url 'knowledgebase:article_detail' article.id %}'">
            <div class="article-card-content">
              <div class="article-card-main">
                <h3>
                  <a href="{% url 'knowledgebase:article_detail' article.id %}">
                    {{ article.title }}
                  </a>
                </h3>
                <p class="article-card-meta">
                  üìÖ {{ article.pub_date|date:"d M Y H:i" }}
                </p>
                {% if article.image or article.video or article.audio %}
                  <div class="article-card-media">
                    {% if article.image %}<span>üñºÔ∏è</span>{% endif %}
                    {% if article.video %}<span>üé•</span>{% endif %}
                    {% if article.audio %}<span>üéµ</span>{% endif %}
                  </div>
                {% endif %}
              </div>
              <div class="article-card-actions">
                {% if user.is_authenticated and perms.knowledgebase.change_article %}
                  <a href="{% url 'knowledgebase:article_edit' article.id %}" 
                     onclick="event.stopPropagation();"
                     class="btn-edit">
                    ‚úèÔ∏è
                  </a>
                {% endif %}
                {% if user.is_authenticated and perms.knowledgebase.delete_article %}
                  <form action="{% url 'knowledgebase:article_delete' article.id %}"
                        method="post"
                        style="display:inline;"
                        onclick="event.stopPropagation();">
                    {% csrf_token %}
                    <button type="submit" 
                            onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é?'); event.stopPropagation();"
                            class="btn-delete">
                      üóëÔ∏è
                    </button>
                  </form>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="no-articles">
        –°—Ç–∞—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç. {% if user.is_authenticated and perms.knowledgebase.add_article %}–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç–∞—Ç—å—é!{% else %}–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç–∞—Ç–µ–π.{% endif %} üìù
      </p>
    {% endif %}
  </div>
</div>
{% endblock %}
